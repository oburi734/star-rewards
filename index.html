<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üåà Xime's Rewards ü¶Ñ</title>

<style>
body {
  font-family: -apple-system, system-ui;
  text-align: center;
  background: linear-gradient(180deg, #ffb6f0, #c6a8ff);
  color: #5a2a7a;
}

h1 { font-size: 34px; }

button {
  font-size: 20px;
  padding: 16px;
  margin: 8px;
  border-radius: 20px;
  border: none;
  width: 90%;
  box-shadow: 0 4px 0 rgba(0,0,0,.2);
}

button:active { transform: scale(.95); }

.chore { background: #ffe066; }
.prize { background: #8be0ff; }
.disabled { background: #ccc; }

.star {
  position: fixed;
  font-size: 30px;
  animation: fly 1s ease-out forwards;
}

@keyframes fly {
  from { transform: translateY(0) scale(1); opacity: 1; }
  to { transform: translateY(-200px) scale(2); opacity: 0; }
}

.count {
  font-size: 28px;
  margin-bottom: 10px;
}

.star-display {
  font-size: 40px;
  margin-bottom: 10px;
}

#history { font-size: 16px; }
</style>
</head>

<body>

<h1>üåà Xime's Rewards ü¶Ñ</h1>

<div class="star-display">
  ‚≠ê‚≠ê‚≠ê
</div>

<div class="count">
  Stars: <span id="starCount">0</span>
</div>

<h2>‚ú® Daily Activities ‚ú®</h2>
<div id="chores"></div>

<h2>üéÅ Prize Store üéÅ</h2>
<div id="prizes"></div>

<h2>üìú Reward History üìú</h2>
<div id="history"></div>

<script>
const audioCache = {};

function preloadSounds() {
  for (const type in sounds) {
    audioCache[type] = new Audio(sounds[type][0]);
    audioCache[type].load();
  }
}

preloadSounds();
let audioUnlocked = false;

function unlockAudio() {

  if(audioUnlocked) return;

  const silent = new Audio(
    "data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAA..."
  );

  silent.play().then(()=>{
    audioUnlocked = true;
    console.log("Audio unlocked");
  }).catch(()=>{});

}

// unlock on first tap anywhere
document.addEventListener("touchstart", unlockAudio, { once:true });
document.addEventListener("click", unlockAudio, { once:true });
// ================= DATA =================

const chores = [
 { name:"üßπ Clean Room", stars:2 },
 { name:"üéπ Piano Practice", stars:1 },
 { name:"üìö Read Book", stars:1 },
 { name:"üß∏ Put Away Toys", stars:1 },
 { name:"ü•¶ New Food", stars:1 },
 { name:"‚ú® Extra Helping", stars:1 }
];

const prizes = [
 { name:"üç¨ Treat", cost:10 },
 { name:"üå≥ Park", cost:20 },
 { name:"üåô Sleepover", cost:20 },
 { name:"üìö Library", cost:25 } 
];

// ================= STATE =================

let stars = parseInt(localStorage.stars)||0;
let today = new Date().toDateString();

let completed = JSON.parse(localStorage.completed||"{}");
let history = JSON.parse(localStorage.history||"[]");

if(localStorage.date!==today){
 completed={};
 localStorage.date=today;
}

// ================= SAVE =================

function save(){
 localStorage.stars=stars;
 localStorage.completed=JSON.stringify(completed);
 localStorage.history=JSON.stringify(history);
 backupToDrive();
}

function update(){
 document.getElementById("starCount").innerText=stars;
}

// ================= SOUND =================

let audioPool = {};

const sounds = {
  //star:new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEA...");
  star: ["sounds/star.wav"],
  win: ["sounds/win.wav"],
  redeem: ["sounds/redeem.wav"]
};

function playSound(type) {

  const audio = audioCache[type];
  if (!audio) return;

  audio.currentTime = 0;

  audio.play().catch(e => {
    console.log("Play failed:", e);
  });

}

// ================= ANIMATION =================

function animateStars(){
 for(let i=0;i<5;i++){
  let star=document.createElement("div");
  star.innerHTML="‚≠ê";
  star.className="star";
  star.style.left=Math.random()*100+"vw";
  star.style.top="70vh";
  document.body.appendChild(star);
  setTimeout(()=>star.remove(),1000);
 }
}

// ================= RENDER =================

function renderChores(){
 let div=document.getElementById("chores");
 div.innerHTML="";

 chores.forEach((c,i)=>{
  let btn=document.createElement("button");
  btn.className="chore";

  if(completed[i]){
   btn.style.background="#9bffb0";
   btn.innerHTML="‚úÖ "+c.name+" (+ "+c.stars+" ‚≠ê)";
  } else {
   btn.innerHTML=c.name+" (+ "+c.stars+" ‚≠ê)";
  }

  btn.onclick=()=>{
   if(completed[i]){
    stars -= completed[i];
    delete completed[i];
    playSound("undo");
   } else {
    stars += c.stars;
    completed[i]=c.stars;
    animateStars();
    playSound("star");
   }

   save();
   update();
   renderChores();
   renderPrizes();
  };

  div.appendChild(btn);
 });
}

function renderPrizes(){
 let div=document.getElementById("prizes");
 div.innerHTML="";

 prizes.forEach(p=>{
  let btn=document.createElement("button");
  btn.className="prize";
  btn.innerHTML=p.name+" (- "+p.cost+" ‚≠ê)";

  if(stars<p.cost){
   btn.disabled=true;
   btn.classList.add("disabled");
  }

  btn.onclick=()=>{
   stars-=p.cost;
   history.unshift({
    name:p.name,
    date:new Date().toLocaleDateString()
   });

   save();
   update();
   renderPrizes();
   renderHistory();
   animateStars();
   playSound("reward");
  };

  div.appendChild(btn);
 });
}

function renderHistory(){
 let div=document.getElementById("history");
 div.innerHTML=history
 .slice(0,10)
 .map(h=>"‚≠ê "+h.name+" ("+h.date+")")
 .join("<br>");
}

// ================= GOOGLE BACKUP =================

const BACKUP_URL = "https://script.google.com/macros/s/AKfycbxROTbRETfZ8hCpVzvh6XMKmv5EoRLtd0BQcz6ivraOP0FJ-079eNvb9fo0cDr72gdi/exec";

async function backupToDrive(){
  const data = { stars: stars, history: history };
  await fetch(BACKUP_URL,{ method:"POST", body: JSON.stringify(data) });
}

async function restoreFromDrive(){
  const res = await fetch(BACKUP_URL);
  const data = await res.json();

  if(data.stars !== undefined){
    stars = data.stars;
    history = data.history || [];
    save();
    update();
    renderHistory();
  }
}

// ================= START =================

async function start(){
  await restoreFromDrive();
  update();
  renderChores();
  renderPrizes();
  renderHistory();
}

start();

</script>

</body>
</html>
